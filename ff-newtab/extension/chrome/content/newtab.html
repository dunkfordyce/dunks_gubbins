<html>
    <head>
        <style type="text/css">
            @import url("chrome://ffnewtab/content/jquery.hrzAccordion.examples.css");

            /* default ------------------------------------------------ */

            /* hide container until all is ready */
            .test, .test2,.test3,.test4{
                display: none;
            }
            /*Main Container*/
            .container {
                width:100%;	
            }
            .container > ul{
                list-style-type: none;
                margin: 0;
                padding:0;	
            }
            .container > ul > li{
                display: inline;
                margin: 0px;
                padding:0px;
            }
            /*Content Container*/
            .contentContainer {
                padding-left: 0px;	
                float: left;
                width:0px;
                height: 310px;	
                overflow:hidden;
            }
            .contentWrapper{	
            }
            .contentInnerWrapper{
                text-align: justify;
                padding: 10px;
            }
            /* Handle*/
            .handle{
                float: left;
                width: 38px;
                height: 310px;
                margin: 1px;
                margin-right: -10px;
                background:  url(../images/blade.png) no-repeat;
            }
            .handleOver{	
                background: url(../images/blade_sel.png) no-repeat;
            }
            .handleSelected{	
                background: url(../images/blade_sel.png) no-repeat;
            }

            /* examples ------------------------------------------------ */
            
            .contentWrapper h3{
                border-bottom: 1px solid silver;
                background-color: #dfdfdf;	
            }
            p{
                padding: 10px;
            }

            /*  TEST 3  */

            /*Main Container*/
            .container3 {
                width:100%;
                position: relative;
            }
            /*
            .container3 ul{
                list-style-type: none;
                margin: 0px;
                padding:0px;	
            }
            .container3 li{
                display: inline; 
                margin: 0px;
                padding:0px;
            }
            */
            /*Handle*/
            .handle3 {
                float: left;
                width: 64px;
                text-align:center;
                height: 100%;

                background: -moz-linear-gradient(top, #ccc 0%,
                                      #9BCB2A 20%,
                                      #5DA331 90%,
                                      #659635 99%,
                                      #ccc 100%);
                border: 1px solid #ccc;
                opacity: 0.3;
                -moz-border-radius: 10px;
            }
            .handle3 div.t{
                /*margin-top:2px;*/
                height: 100%;
                position:relative;
            }

            .handle3 div.t1 {
                background: url('chrome://ffnewtab/content/history.png'), url('chrome://ffnewtab/content/logo.png');
                background-position: center bottom, -50 0;
                background-repeat: no-repeat, no-repeat;
            }
            .handle3 div.t2 {
                background: url('chrome://ffnewtab/content/history.png'), url('chrome://ffnewtab/content/logo.png');
                background-position: center bottom, -116 0;
                background-repeat: no-repeat, no-repeat;
            }
            .handle3 div.t3 {
                background: url('other_tabs.png'), url('logo.png');
                background-position: center bottom, -182 0;
                background-repeat: no-repeat, no-repeat;
            }

            .handle3 div h2 {
                -moz-transform: rotate(-90deg); 
                bottom:50px;
                color:white;
                display:inline;
                left:-54px;
                padding:0;
                position:absolute;
            }

            .handleOver3{
                /*background: red;*/
                /*border: 1px solid white;*/
                opacity: 0.6;
            }
            .handleOver3 div {
                /*margin-top:2px;*/
            }
            .handleSelected3{
                opacity:.90;
            }
            /*Content Container*/
            .contentWrapper3{
                text-align: justify;
                position: absolute;
                left: 0px;
                top: 0px;
                right: 0px;
                bottom: 0px;
            }
            .contentInnerWrapper3{
                position: absolute;
                left: 0px;
                top: 0px;
                right: 0px;
                bottom: 0px;
            }
            .contentWrapper3 h3{
                border-bottom: 1px solid silver;
                color: #1E90FF;
            }
            .contentContainer3 {
                padding-left: 0px;	
                float: left;
                width:0px;
                height: 310px;	
                overflow:hidden;
            }
            .contentContainer {
                position:relative;
                height: 100%;
            }

            /*  TEST 4  */
            .test4 .handle {
                float: left;
                width: 32px;
                height: 310px;
                margin: 1px;
                margin-right: -10px;
                background:  url(../images/blade_grey.png) no-repeat;
                text-align:center;
                padding-top:10px;
                font-weight: bold;
                color: #9e9e9e;
                font-size: 16px;
            }
            .test4 .handleOver{	
                background: url(../images/blade_grey_sel.png) no-repeat;
            }
            .test4 .handleSelected{
                
                background: url(../images/blade_grey_sel.png) no-repeat;
            }

            /* mine ------------------------------------------------ */

            .favourite {
                display: block;

                font-family: Helvetica, Arial, sans-serif;
                font-weight: bold;
                font-size: 138.5%;
                 
                text-align: left;
                text-decoration: none;

                padding: 10px;
                -moz-border-radius: 10px;

                border: 1px solid #659635;

                /*
                text-shadow: +1px +1px 2px #777777;
                */
                color: #ffffff;

                /*
                background: -moz-linear-gradient(top, #CFE782 0%,
                                      #9BCB2A 2%,
                                      #5DA331 97%,
                                      #659635 100%);
                */
                background: -moz-linear-gradient(top, #ccc 0%,
                                      #C8CAE8 2%,
                                      #A7ABEB 97%,
                                      #5F69E8 100%);
                margin: 5px;
            }
        
            .favourite:hover {
                background: -moz-linear-gradient(top, #CFE782 0%,
                                      #aBdB3A 2%,
                                      #6Db341 97%,
                                      #75a645 100%);
                /*
                text-shadow: -1px -1px 2px #777777;
                */
            }
    
            .favourite a {
                text-decoration: none;
                color: #f1f1f1;
            }
            .favourite a:hover {
                color: #fff;
            }

            img { 
                border: 0px; 
            }

            strong {
                font-weight: bold;
            }

            
            .favourite h1 {
                float: right;
                font-size: 85%;
                margin: 0px;
                padding: 0px;
                margin-right: 15px;
                margin-top: 16px;
                padding-left: 50px;
            }

            .favourite .favicon {
                float: right;
                width: 64px;
                height: 64px;
                position: relative;
                top: -3px;
                opacity: 0.7;
                /*
                border: 1px solid red;
                */
            }

            #favourites .favourite_urls {
                display: block;
                list-style-type: none;
                text-align: left;
                font-size: 60%;
                margin: 0px;
                padding: 0px;
                overflow: hidden;
                text-overflow: ellipsis;
                font-weight: normal;
            }


            #favourites .favourite_urls li {
                display: block;
                overflow: hidden;
                word-wrap: normal;
                text-wrap: none;
                white-space: nowrap;
                width: 1000%;
                text-overflow: ellipsis;
            }

            #favourites .favourite_urls .li a {
            }

            #recent {
                position: absolute;
                left: 2px;
                right: 2px;
                top: 2px;
                bottom: 2px;
                margin: 2px;
                overflow: auto;
            }

            #history {
                position: absolute;
                overflow: hidden;
                clip: auto;
                left: 0px;
                right: 0px;
                top: 0px;
                bottom: 0px;
                vertical-align: center;
            }

            .main-box {
                border: 1px solid white;
                -moz-border-radius: 10px;
                background: #eee;
            }

            body {
                background: #ccc;
            }

            #history-older, #history-newer {
                border: 1px solid white;
                left: 0px;
                right: 0px;
                position: absolute;
                height: 20px;
                -moz-border-radius: 10px;
            }

            #history-older {
                bottom: 0px;
            }
        
            #history-newer {
                top: 0px;
            }

            #history-line { 
                position: absolute;
                background: green;
                top: 0px;
                bottom: 0px;
                left: 50%;
                padding: 2px;
            }

            .history-mark {
                position: absolute;
                left: 50%;
                padding-left: 10px;
                padding-right: 10px;
                padding-top: 1px;
                padding-bottom: 1px;
                background: green;
            }

            .handle3 div.t1 {
                background: url('chrome://ffnewtab/content/favourties.png'), url('chrome://ffnewtab/content/logo.png');
                background-position: center bottom, -50 0;
                background-repeat: no-repeat, no-repeat;
            }
            .handle3 div.t2 {
                background: url('chrome://ffnewtab/content/history.png'), url('chrome://ffnewtab/content/logo.png');
                background-position: center bottom, -116 0;
                background-repeat: no-repeat, no-repeat;
            }
            .handle3 div.t3 {
                background: url('other_tabs.png'), url('logo.png');
                background-position: center bottom, -182 0;
                background-repeat: no-repeat, no-repeat;
            }
        </style>

        <script type="text/javascript">

        var historyService = Components.classes["@mozilla.org/browser/nav-history-service;1"]
                                       .getService(Components.interfaces.nsINavHistoryService);
        var faviconService = Components.classes["@mozilla.org/browser/favicon-service;1"]
                               .getService(Components.interfaces.nsIFaviconService);
        var ioService = Components.classes["@mozilla.org/network/io-service;1"]  
                    .getService(Components.interfaces.nsIIOService);  

        function makeURI(aURL, aOriginCharset, aBaseURI) {  
            return ioService.newURI(aURL, aOriginCharset, aBaseURI);  
        }  

        // No query options set will get all history, sorted in database order,
        // which is nsINavHistoryQueryOptions.SORT_BY_NONE.
        var options = historyService.getNewQueryOptions();
        options.sortingMode = options.SORT_BY_VISITCOUNT_DESCENDING;
        options.resultType = options.RESULTS_AS_URI;

        // No query parameters will return everything
        var query = historyService.getNewQuery();

        // execute the query
        var result = historyService.executeQuery(query, options);

        var cont = result.root;
            cont.containerOpen = true;
            
        var dom_data = {};

        for (var i = 0; i < cont.childCount; i ++) {
            var node = cont.getChild(i);
            //document.write(node.accessCount+','+node.title+','+node.uri+'<br/>');
            var uri = makeURI(node.uri);
            if( !dom_data[uri.host] ) {
                dom_data[uri.host] = {
                    host: uri.host,
                    accessCount: 0,
                    urls: []
                };
            }
            dom_data[uri.host].urls.push({accessCount: node.accessCount, title: node.title, uri: node.uri});
            dom_data[uri.host].accessCount += node.accessCount;
        }
 
        var sorted_dom_data = [];
        for( var k in dom_data ) {
            sorted_dom_data.push(dom_data[k]);
        }       

        sorted_dom_data.sort(function(a, b) {
            return b.accessCount - a.accessCount;
        });

        //document.write('<ul>');
        sorted_dom_data.forEach(function(dom) {
            //document.write('<li>'+dom.accessCount + ','+dom.host + '<ul>');
            dom.urls.sort(function(a, b) {
                return b.accessCount - a.accessCount;
            });
            //dom.urls.forEach(function(url) {
            //    document.write('<li>'+url.accessCount+' '+url.uri+'</li>');
            //});
            //document.write('</ul></li>');
        });
        //document.write('</ul>');

        </script>

        <script type="text/javascript" src="jquery-1.3.2.js"></script>
        <script type="text/javascript" src="jquery.easing.1.3.js"></script>
        <script type="text/javascript" src="jquery.hrzAccordion.js"></script>
        <script type="text/javascript" src="jquery.mousewheel.js"></script>
        <script type="text/javascript" src="jquery.text-overflow.js"></script>

        <script type="text/javascript">
        function g() {
            $(".test3").hrzAccordion({
               //containerClass     : "container3",
               listItemClass      : "listItem3",
               contentWrapper     : "contentWrapper3",
               contentInnerWrapper: "contentInnerWrapper3",
               handleClass        : "handle3",
               handleClassOver    : "handleOver3",
               handleClassSelected: "handleSelected3",
               openOnLoad: 1
              });

            var $fav = $('#template_fav').clone();
            $('#template_fav').remove();
            var $target = $('#favourites');
            sorted_dom_data.forEach(function(dom) {
                var $el = $fav.clone();
                $el.find('.url').text(dom.host || 'localhost').attr('href', dom.host);
                var $ul  = $el.find('ul');
                for( var i=0; i!=dom.urls.length && i < 3; i++ ) {
                    var url = dom.urls[i];
                    $ul.append($('<li/>').append($('<a/>').attr({href: url.uri, title:url.uri}).html('<strong>'+url.title +'</strong> - '+url.uri)));
                }
                
                $target.append($el);

                var c = {
                    backgroundImage: 'url("'+faviconService.getFaviconImageForPage(makeURI(dom.urls[0].uri)).spec+'")',
                    '-moz-background-size': '64 64'
                };

                $el.find('.favicon').css(c);
            });

            $('#favourites').mousewheel(function(e) {
                var $f = $('.contentInnerWrapper3');
                var p = $f.position();
                $f.position(p.left, p.top + e.detail);
            });

            $('.favourite_urls li').ellipsis();
        }
        $(document).ready(function() {g();});
        </script>
    </head>
    <body>
        <div class="main-box" id="recent">
            <ul class="test3" style="position: absolute; left: 2px; top: 2px; bottom: 2px; right: 2px; border: 0px solid blue;">
                <li>
                    <div class="handle3">
                        <div class="t t1">
                        </div>
                    </div>
                    <div class="favourite" style="font-size: 150%;" href="http://google.com" id="template_fav">
                        <div class="favicon"></div>
                        <h1><a class="url">http://google.com</a></h1>
                        <ul class="favourite_urls">
                        </ul>           
                    </div>
                    <div id="favourites">

                    </div>
                    <!--a style="font-size: 100%;" href="http://google.com">
                        <img height="30" style="float: left;" src="https://mail.google.com/mail/images/favicon.ico">
                        <span class="title">Google Search Engine</span><br>
                        <span class="url">http://google.com</span>
                    </a>
                    <a style="font-size: 90%;" href="http://google.com">
                        <img style="float: left;" src="https://mail.google.com/mail/images/favicon.ico">
                        <span class="title">Google Search Engine</span><br>
                        <span class="url">http://google.com</span>
                    </a-->
                </li>
                <li>
                    <div class="handle3">
                        <div class="t t2">
                        </div>
                    </div>
                    <div class="main-box" id="history">
                        <div id="history-older"></div>
                        <div id="history-newer"></div>

                        <div id="history-line"></div>
                        <div style="top: 50px;" class="history-mark"></div>
                        <div style="top: 100px;" class="history-mark"></div>
                        <div style="top: 150px;" class="history-mark"></div>
                        <div style="top: 200px;" class="history-mark"></div>
                        <div style="top: 250px;" class="history-mark"></div>
                        <div style="top: 300px;" class="history-mark"></div>
                        <div style="top: 350px;" class="history-mark"></div>
                        <div style="top: 400px;" class="history-mark"></div>
                        <div style="top: 450px;" class="history-mark"></div>
                        <div style="top: 500px;" class="history-mark"></div>
                        <div style="top: 550px;" class="history-mark"></div>
                    </div>
                </li>
                <li>
                    <div class="handle3">
                        <div class="t t3">
                        </div>
                    </div>
                    <h3>boo</h3>
                    <p>booools</p>
                </li>
            </ul>
        </div>

    </body>
</html>
